# 交换机/嵌入式设备专用配置
# Switch Device Configuration
#
# 此配置针对低内存环境（256MB-512MB RAM）优化
# 适用于网络交换机、路由器等嵌入式设备
#
# 使用方法:
#   ./opt-switch server -c config/settings.switch.yml

settings:
  application:
    # 运行模式: prod生产模式（减少调试开销）
    mode: prod

    # 监听地址
    host: 0.0.0.0

    # 服务端口
    port: 8000

    # 读写超时（秒）- 增加以减少连接重建
    readtimeout: 30
    writertimeout: 30

    # 数据权限功能开关（关闭以减少计算）
    enabledp: false

  logger:
    # 日志存放路径 - 使用 /tmp 避免写闪存
    path: /tmp/opt-switch/logs

    # 控制台日志 - 启用以避免文件 I/O
    stdout: '1'

    # 日志等级 - warn 级别减少日志量
    # trace, debug, info, warn, error, fatal
    level: warn

    # 数据库日志开关 - 关闭以提高性能
    enableddb: false

  jwt:
    # token 密钥 - 生产环境请务必修改
    secret: opt-switch

    # token 过期时间（秒）
    timeout: 3600

  database:
    # 数据库类型 - SQLite3（纯 Go，无 CGO 依赖）
    driver: sqlite3

    # 数据库文件路径 - 使用 /tmp 或外部存储
    source: /tmp/opt-switch-db.db

    # 数据库连接池配置 - 针对低内存优化
    # 注意: glebarez/sqlite 使用纯 Go 实现

    # 最大打开连接数（默认: 100）- 降低以减少内存
    maxOpenConns: 5

    # 最大空闲连接数（默认: 10）
    maxIdleConns: 2

    # 连接最大生存时间（秒）
    connMaxLifetime: 300

    # 空闲连接最大生存时间（秒）
    connMaxIdleTime: 60

  # 内存队列配置 - 降低内存占用
  queue:
    memory:
      # 内存队列池大小（默认: 100）- 降低以减少内存
      poolSize: 20

  # 缓存配置
  cache:
    # 使用内存缓存（不使用 Redis）
    memory: ''

    # Redis 缓存（交换机通常不启用）
    # redis:
    #   addr: 127.0.0.1:6379
    #   password: ""
    #   db: 0

# =============================================================================
# 性能优化说明
# =============================================================================
#
# 1. 内存优化:
#    - 数据库连接池: 100→5 (maxOpenConns)
#    - 空闲连接: 10→2 (maxIdleConns)
#    - 内存队列: 100→20 (poolSize)
#
# 2. I/O 优化:
#    - 使用控制台日志，避免闪存写入
#    - 日志级别: trace→warn
#    - 关闭数据库日志
#
# 3. 生产模式:
#    - 禁用调试模式，减少开销
#    - 增加超时时间，减少连接重建
#
# =============================================================================
#
# 预期内存占用（约）:
#   - Go 运行时: 30-50MB
#   - SQLite + 数据: 10-20MB
#   - 连接池/队列: 10-20MB
#   - HTTP 服务: 5-10MB
#   - 总计: 约 60-100MB
#
# 适用场景:
#   - 内存: 256MB-512MB
#   - 存储: 至少 100MB 可用空间
#   - CPU: 单核或双核，600MHz+ 即可
#
# =============================================================================
#
# 存储说明:
#   - SQLite 数据库文件会增长
#   - 建议挂载外部存储（USB/SD 卡）
#   - 或定期清理日志和数据库
#
# =============================================================================
